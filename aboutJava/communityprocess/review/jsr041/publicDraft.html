
<!-- ** BEGIN: header.jsp ** //-->






















<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
    

   
    <link href="/includes/css/menu.css" rel="stylesheet" type="text/css"></link>
    <link href="/includes/css/style.css" rel="stylesheet" type="text/css"></link>
    <!--[if lt IE 6]><link href="/includes/css/style5.css" rel="stylesheet" type="text/css" ></link><![endif]-->
    <!--[if gte IE 5]><link href="/includes/css/style6.css" rel="stylesheet" type="text/css" ></link><![endif]-->
    <link href="/includes/css/tabs.css"  rel="stylesheet" type="text/css"></link>

    <script type="text/javascript" src="/includes/scripts/tabs.js"></script>
    <script type="text/javascript" src="/includes/scripts/menu.js"></script>
   

    

    
        <title>The Java Community Process(SM) Program - communityprocess - review</title>
    

    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>



<body onload="P7_initPM(0,1,0,0,-1)">

    <a name="top"></a>

    <div id="header">
	<div id="logo">
		<a href="/en/home/index"><img src="/images/spacer.gif" alt="Java Community Process" height="81" width="151"></a>
	</div>
	<div id="tools">
		<div class="search">
			<form name="search" action="/en/jsr/summary" method="get" onsubmit="return validate_search()">
				<input name="id" value="Search JSRs" size="16" class="form" onfocus="nullify_if_equal(this, 'Search JSRs')" type="text">
				<a href="javascript:document.search.submit()" onclick="return validate_search()"><img src="/images/button_go.gif" width="21" height="16" border="0" alt="Submit this Search" name="sub_search"></a>
			</form>
		</div>
		<div class="tools">
			<a href="/en/press/pressroom">Press Room</a> &nbsp;|&nbsp;
			<a href="http://java.com/java/download/index.jsp?cid=jdp78399">Get Java Here</a> &nbsp;|&nbsp;
			<!-- <a href="javascript:void(0)">Print Format</a> &nbsp;|&nbsp;&nbsp; -->
		</div>

	</div>
	<div style="clear: right;"></div>

        

	<div class="topbar"><img src="/images/spacer.gif" alt="" height="3" width="154"></div>
	<div id="update"> </div>
    </div>


    

        <!-- ** BEGIN: Content Table ** //-->

        <table width="100%" border="0" cellpadding="0" cellspacing="0">

            <tr>

                <!-- ** BEGIN: Navigation Column ** //-->
                <td width="150" id="leftcontent" valign="top">
                    <!-- Navigation Placeholder //-->

                    

                    <div class="bar"><img src="/images/hr_dots1.gif" alt="" height="3" width="150"></div>

        <!-- begin find JSRs form -->
        <!-- IMPORTANT! do not convert this form to Struts < html : form > tag.  javascript change of form.action property fails. -->
        <img src="/images/hd_find-jsrs.gif" alt="Find JSRs" height="18" width="150">
        <form name="findjsr" action="/en/jsr/summary" method="get" class="pt5" onsubmit="return validate_findjsr()">
            <input name="id" size="18" class="form" value="Search JSRs" onfocus="nullify_if_equal(this, 'Search JSRs')" type="text">
	    <a href="javascript:document.findjsr.submit()" onclick="return validate_findjsr()"><img src="/images/button_go.gif" width="21" height="16" border="0" alt="Submit this Search" name="sub_search"></a>
        </form><br><br>

        <!-- ** Menu Start ** //-->

        <ul id="p7PMnav">
            <li><a href="/en/jsr/platform">JSRs by Platform</a></li>
            <li><a href="/en/jsr/tech">JSRs by Technology</a></li>
            <li><a href="/en/jsr/stage">JSRs by Stage</a></li>
            <li><a href="/en/jsr/ec">JSRs by Committee</a></li>
            <li><a href="/en/jsr/all">List of All JSRs</a></li>

            <!--end find JSRs form -->
            <div style="clear: both;"><img src="/images/spacer.gif" alt="" height="25" width="1"></div>

            <!--begin my JCP -->
            <img src="/images/hd_my-jcp.gif" alt="My JCP" height="18" width="150">
            

          <form name="login" method="get" action="/en/user/login" >
            <input name="Sign-in" type="submit" title="Sign-in" value="Sign-in" />
          </form>

            <div style="clear:both"><img src="/images/global/spacer.gif" width="1" height="3" alt=""></div>
            <div class="noNav">
                <a href="/en/user/register">Register for Site</a>
            </div>

             <div class="bar"><img src="/images/hr_dots1.gif" alt="" height="3" width="150"></div>
           <div class="noNav" style="color: #666666; padding: 0;">
              Use of JCP site is subject to the
              <a href="/en/home/terms" style="display:inline;padding: 0">JCP Terms of Use</a> and the
              <a href="http://www.oracle.com/us/legal/privacy/index.html" style="display:inline;padding: 0" href="">Oracle Privacy Policy</a>
          </div>

            

            <div style="clear:both"><img src="/images/global/spacer.gif" width="1" height="25" alt=""></div>

            <!--begin JCP info -->
            <img src="/images/hd_jcp-info.gif" alt="JCP Info" height="18" width="150">

            <li><a href="/en/procedures/overview" class="p7PMtrg">About JCP</a>
                <ul>
                    <li><a href="/en/procedures/overview">Program Overview</a></li>
                    <li><a href="/en/procedures/jcp2">JCP Process Document</a></li>
                    <li><a href="/en/whatsnew/calendar">Calendar</a></li>
                    <li><a href="/en/participation/members">JCP Members</a></li>
                    <li><a href="/en/participation/committee">Executive Committee</a></li>
                    <li><a href="/en/whatsnew/elections">Elections</a></li>
                </ul>
            </li>

            <li><a href="/en/participation/overview" class="p7PMtrg">Get Involved</a>
		<ul>
                    <li><a href="/en/participation/overview">Overview</a></li>
                    <li><a href="/en/participation/membership">Becoming a JCP Member</a></li>
		</ul>
            </li>

            <li><a href="/en/resources/contents" class="p7PMtrg">Community Resources</a>
                <ul>
                    <li><a href="/en/resources/contents">Overview</a></li>
                    <li><a href="/en/resources/tutorials">Tutorials</a></li>
                    <li><a href="/en/resources/multimedia">JCP Podcasts</a></li>
                    <li><a href="/en/resources/guide">Spec Lead Guide</a></li>
                    <li><a href="/en/resources/tdk">TCK Tool & Info</a></li>
                    <li><a href="/en/resources/license_reference">License Reference</a></li>
                </ul>
            </li>

            <li><a href="/en/press/pmo" class="p7PMtrg">Community News</a>
                <ul>
                    <li><a href="/en/press/pmo">News</a></li>
                    <li><a href="/en/press/news/awards/awards_main">Programs &amp; Awards</a></li>
                    <li><a href="/en/press/releases">Press Releases</a></li>
                    <li><a href="/en/press/success">Success Stories</a></li>
                </ul>
            </li>

            <li><a href="/en/introduction/faq">FAQ</a></li>

            <li><a href="/en/resources/contacts">Contact Us</a></li>

            <div style="clear: both;"><img src="/images/spacer.gif" alt="" height="25" width="1"></div>

            <!--[if lte IE 6]><style>#p7PMnav a{height:1em;}#p7PMnav li{height:1em;float:left;clear:both;width:100%}</style><![endif]-->
            <!--[if IE 6]><style>#p7PMnav li{clear:none;}</style><![endif]-->
            <!--[if IE 7]><style>#p7PMnav a{zoom:100%;}#p7PMnav li{float:left;clear:both;width:100%;}</style><![endif]-->
        </ul>

        

        <!--begin ad space -->
        <div class="ads">
            <a href="http://java.com/java/download/index.jsp?cid=jdp78399" target="_blank"><img style="display: ;" src="/images/ad_banner2.gif" alt="Ad Banner" border="1" height="70" width="150"></a>
        </div>
        <!--end ad space -->

<!-- ** Menu End ** //-->
&nbsp;<br>
&nbsp;<br>
&nbsp;<br>

    

                    &nbsp;<br>
                    <img src="/images/common/trans.gif" alt="" width="1" height="150"><br>

              



                </td>
                <!-- ** END: Navigation Column ** //-->

                <!-- ** BEGIN: Gutter Column ** //-->
		<td width="10" nowrap><img src="/images/common/trans.gif" alt="" width="10" height="1"></td>
                <!-- ** END: Gutter Column ** //-->

                <!-- ** BEGIN: Content Column ** //-->
                <td width="100%" valign="top">

    
<script type="text/javascript">

String.prototype.trim = function() {
        return this.replace(/^\s+|\s+$/g,"");
}
String.prototype.ltrim = function() {
        return this.replace(/^\s+/,"");
}
String.prototype.rtrim = function() {
        return this.replace(/\s+$/,"");
}

function validate_search() {
	if (document.search.id.value == "Search JSRs" || document.search.id.value.trim().length == 0) {
		alert("Search terms must be entered first");
		return false;
	}
	return true;
}

function validate_findjsr() {
	if (document.findjsr.id.value == "Search JSRs" || document.findjsr.id.value.trim().length == 0) {
		alert("Search terms must be entered first");
		return false;
	}
	return true;
}

function nullify_if_equal(field, str) {
	// alert("val=" + field.value);
	if (field.value == str) {
		field.value = "";
	}
}

</script>
<!-- ** END: header.jsp ** //-->






<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>Public Draft, JSR-000041: A Simple Assertion Facility For the Javaï¿½ Programming Language</TITLE></HEAD>

<body bgcolor="#ffffff">
<center>
<h2>A Simple Assertion Facility For the Java<font size=-1><sup>tm</sup></font>
Programming Language</h2>
<h3>Public Draft</h3>
</center>
<hr>
<br>&nbsp;

<H2>I. Introduction</H2>

This document specifies a simple <I>assertion facility</I> for the Java
programming language.  In its intended usage, an <I>assertion</I> is a
statement containing a boolean expression that the programmer believes to be
true at the time the statement is executed.  For example, after unmarshalling
all of the arguments from a data buffer, a programmer might assert that the
number of bytes of data remaining in the buffer is zero. The system executes
the assertion by evaluating the boolean expression and reporting an error if
the expression evaluates to <TT>false</TT>.  By verifying that the boolean
expression is indeed true, the system corroborates the programmer's knowledge
of the program and increases one's confidence that the program is free of
bugs.  Assertion checking may be disabled for increased performance.
Typically, assertion-checking is enabled during program development and
testing, and disabled for deployment.

<P>Because assertions may be disabled, programs must not assume that the
expressions contained in assertions will be evaluated.  Thus, these boolean
expressions should generally be free of <i>side effects</i>: evaluating such a
boolean expression should not affect any state that is visible after the
evaluation is complete.  It is not illegal for a boolean expression contained
in an assertion to have a side effect, but it is generally inappropriate, as
it could cause program behavior to vary depending on whether assertions were
enabled or disabled.

<P>Along similar lines, assertions should not be used for argument-checking in
public methods.  Argument-checking is typically part of the contract of a
method, and this contract must be upheld whether assertions are enabled or
disabled. Another problem with using assertions for argument checking is that
erroneous arguments should result in an appropriate runtime exception (such as
<TT>IllegalArgumentException</TT>, <TT>IndexOutOfBoundsException</TT> or
<TT>NullPointerException</TT>).  An assertion failure will not throw an
appropriate exception.  Again, it is not illegal to use assertions for
argument checking on public methods, but it is generally inappropriate.

<H2>II. Syntax</H2>
A new keyword is added to the language: <TT>assert</TT>. The use of this
keyword is governed by one modified production and one new production in the
grammar:
<PRE>    <I>StatementWithoutTrailingSubstatement:</I>
        <I>&lt;All current possibilities, as per JLS, Section 14.4&gt;</I>
        <I>AssertStatement</I>

    <I>AssertStatement:</I>
        assert <I>Expression<sub>1</sub></I> ;
        assert(<I>Expression<sub>1</sub></I>, <I>Expression<sub>2</sub></I>) ;
</PRE>In both forms of the <TT>assert</TT> statement,
<I>Expression<sub>1</sub></I> must have type <TT>boolean</TT> or a
compile-time error occurs.

<A name=semantics><h2>III. Semantics</h2></a>
Assertions may be <I>enabled</I> or <I>disabled</I> on a per-class basis. At
the time that a class is loaded, its class loader determines whether
assertions are enabled or disabled as described <A href="#below">below</A>.
Once a class has been loaded, its <I>assertion status</I> (enabled or
disabled) does not change.

<p>If assertions are disabled in a class, an <tt>assert</tt> statement
contained in that class does nothing.  In particular, its "arguments" (
<I>Expression<sub>1</sub></I> and, if it is present,
<I>Expression<sub>2</sub></i>) are not evaluated.  Execution of an
<tt>assert</tt> statement that is contained in a class in which assertions are
disabled always completes normally.

<p>If assertions are enabled in a class, an <tt>assert</tt> statement
contained in that class is executed by first evaluating
<I>Expression<sub>1</sub></I>.  If evaluation of <I>Expression<sub>1</sub></I>
completes  abruptly for some reason, the <TT>assert</TT> statement completes 
abruptly for the same reason. Otherwise, execution continues by
making a choice based on the value of <I>Expression<sub>1</sub></I>:
<ul>
  <li>If the value is <TT>true</TT>, no further action is taken and
  the <TT>assert</TT> statement completes normally. 

   <li>If the value is <TT>false</TT>, the execution behavior depends on
   whether <I>Expression<sub>2</sub></I> is present:
  <ul>

  <LI>If <I>Expression<sub>2</sub></I> is present, it is evaluated.  If the
  evaluation completes abruptly for some reason, the <TT>assert</TT> statement
  completes abruptly for the same reason.  If the evaluation completes
  normally, the resulting value is converted to a <tt>String</tt> as specified
  in JLS Section 15.17.1.1.  If the <tt>String</tt> conversion completes
  abruptly for some reason, the <TT>assert</TT> statement completes abruptly
  for the same reason.  If the <tt>String</tt> conversion completes normally,
  an <TT>AssertionError</TT> instance whose "detail message" is the result of
  the <tt>String conversion</tt> is created.  If the instance creation
  completes abruptly for some reason, the <TT>assert</TT> statement completes
  abruptly for the same reason.  If the instance creation completes normally,
  the <tt>assert</tt> statement completes abruptly by throwing the newly
  created <TT>AssertionError</TT> object.

  <LI>If <I>Expression<sub>2</sub></I> is not present, an
  <TT>AssertionError</TT> instance with no "detail message" is 
  created.  If the instance creation completes abruptly for
  some reason, the <TT>assert</TT> statement completes abruptly
  for the same reason.  If the instance creation completes normally,
  the <tt>assert</tt> statement completes abruptly by throwing the
  newly created <TT>AssertionError</TT> object.
  </uL>
</ul>

<H2><A name=below>IV. Enabling and Disabling Assertions</A></H2>
Each class loader maintains a <I>default assertion status</I>, a boolean 
value that determines whether assertions are, by default, enabled or 
disabled in new classes that are subsequently loaded by the class 
loader.  A newly created class loader's default assertion status is 
<TT>false</TT> (disabled).  It can be changed at any time by invoking 
a new method in class <TT>ClassLoader</TT>:

<PRE>
    /**
     * Sets the <I>default assertion status</I> for this class loader.  This
     * setting determines whether classes loaded in the future by this class
     * loader will have assertions enabled or disabled by default.  This
     * setting may be overridden on a per-package or per-class basis by
     * invoking <tt>setPackageAssertionStatus</tt> or
     * <tt>setClassAssertionStatus</tt>.
     *
     * @param enabled <TT>true</TT> if classes loaded by this class loader
     *        will henceforth have assertions enabled by default,
     *        <TT>false</TT> if they will have assertions disabled by default.
     */
    public void setDefaultAssertionStatus(boolean enabled);
</PRE>

If, at the time that a class is loaded, its class loader has been given
specific instructions regarding the assertion status of the class's package
name or its class name (via either of the two new methods in
<tt>ClassLoader</tt> described below), those instructions take precedence over
the class loader's default assertion status.  Otherwise, the class's
assertions are enabled or disabled as specified by its class loader's default
assertion status.

<p>The following method allows the invoker to set a per-package default
assertion status.  Note that a per-package default actually applies to a
package and any "subpackages."<PRE> 
    /**
     * Sets the <I>package default assertion status</I> for the named
     * package.  The package default assertion status determines the
     * <I>assertion status</I> for classes loaded in the future that belong
     * to the named package or any of its "subpackages."
     *   
     * A subpackage of a package named <i>p</i> is any package whose name
     * begins with "<i>p</i><tt>.</tt>" .  For example, javax.swing.text is
     * a subpackage of <tt>javax.swing</tt>, and both <tt>java.util</tt>
     * and <tt>java.lang.reflect</tt> are subpackages of <tt>java</tt>.
     *
     * In the event that multiple package defaults apply to a given
     * class, the package default pertaining to the most specific package
     * takes precedence over the others.  For example, if
     * <tt>javax.lang</tt> and <tt>javax.lang.reflect</tt> both have
     * package defaults associated with them, the latter package
     * default applies to classes in <tt>javax.lang.reflect</tt>.
     *
     * Package defaults take precedence over the class loader's default
     * assertion status, and may be overridden on a per-class basis by
     * invoking <TT>setClassAssertionStatus</TT>.
     *
     * @param packageName the name of the package whose package default
     *        assertion status is to be set. A <tt>null</tt> value
     *        indicates the <i>unnamed package</i> that is <i>"current"</i>
     *        (JLS 7.4.2).

     * @param enabled <TT>true</TT> if classes loaded henceforth
     *        by this class loader and belonging to the named package
     *        or any of its subpackages will have assertions enabled
     *        by default, <TT>false</TT> if they will have assertions
     *        disabled by default.
     * @throws IllegalArgumentException if <tt>packageName</tt> is non-null and
     *         does not constitute a valid <i>name</i>, as defined in JLS 6.2.
     */
    public void setPackageAssertionStatus(String packageName, boolean enabled);
</PRE>

The following method is used to set assertion status on a per-class basis:
<PRE>
    /**
     * Sets the <I>assertion status</I> for the named top-level class in
     * this class loader and any nested classes contained therein.
     * This setting takes precedence over the  class loader's default
     * assertion status, and over any applicable per-package default.
     * This method has no effect if the named class has already been
     * loaded by this class loader.  (Once a class is loaded, its assertion
     * status cannot change.)  The return value of this method may
     * be examined to determine whether an invocation had any effect.
     *
     * If the named class is not a top-level class, this call will have no
     * effect on the actual assertion status of any class, and its return
     * value is undefined.
     *
     * @param className the fully qualified class name of the top-level class
     *        whose assertion status is to be set.
     * @param enabled <TT>true</TT> if the named class is to have assertions
     *        enabled when (and if) it is loaded by this class loader,
     *        <TT>false</TT> if the class is to have assertions disabled.
     * @returns the assertion status of the named class if it is already
     *          loaded, or <tt>enabled</tt> if it is not.  (In the absence of
     *          a second, subsequent invocation of this method, the return
     *          value is the assertion status that the named class has or will
     *          have once it is loaded.)
     * @throws IllegalArgumentException if <tt>className</tt> does not
     *         constitute a valid <i>name</i> as defined in JLS 6.2.
     */
    public boolean setClassAssertionStatus(String className, boolean enabled);
</PRE>

Finally, a method is added to ClassLoader to allow the desired assertion status
for a specified class (as set by the three methods above) to be queried.  Few
programmers will have any need for this method; it is provided for the benefit
of the JRE itself.  (It allows a class to determine at the time that it is
loaded whether assertions should be enabled.)
<PRE>
    /**
     * Returns the assertion status that would be assigned to the specified
     * class if it were to be loaded at the time this method is invoked.  If
     * the named class has had its assertion status set, the most recent
     * setting will be returned; otherwise, if any package default assertion
     * status pertains to this class, the most recent setting for the most
     * specific pertinent package default assertion status is returned;
     * otherwise, this class loader's default assertion status is returned.
     *
     * The behavior of this method is unspecified if <tt>className</tt>
     * does not constitute a valid <i>name</i> as defined in JLS 6.2.
     *
     * Few programmers will have any need for this method; it is provided
     * for the benefit of the JRE itself.  (It allows a class to determine at
     * the time that it is loaded whether assertions should be enabled.)
     * Note that this method is <i>not</i> guaranteed to return the actual
     * assertion status that was (or will be) associated with the specified
     * class when it was (or will be) loaded.
     *
     * @param  className the fully qualified class name of the top-level class
     *         whose desired assertion status is being queried.
     * @return the desired assertion status of the specified class.
     * @see    setClassAssertionStatus
     * @see    setPackageAssertionStatus
     * @see    setDefaultAssertionStatus
     */
    public boolean desiredAssertionStatus(String className);
</PRE>

The three new <tt>ClassLoader</tt> instance methods for setting desired
assertion status will generally <i>not</i> be used by normal Java programs,
but by Java interpreters.  Java interpreters should provide some
interpreter-specific facility for users to enable and disable asserts.  One
possible approach is described in Appendix II.

<H2>V. New Error Class</H2>
The following error class is added to package <TT>java.lang</TT>: 
<PRE>
/**
 * Thrown to indicate that an assertion has failed.
 */
public class AssertionError extends Error () {
    /**
     * Constructs an AssertionError with no detail message.
     */
    public AssertionError();
                          
    /**
     * Constructs an AssertionError with the specified detail message.
     */
    public AssertionError(String detailMessage);
}
</PRE>

<hr>

<b>The material contained in the appendices below is not part of this
specification, but is intended to inform the use and implementation of the
facility.  In the parlance of the standards community, these 
appendices are <i>non-normative</i>.</b>

<H2>Appendix I. Usage Notes</H2>

In this Appendix we present  examples of appropriate and inappropriate use off
the <tt>assert</tt> construct.   This appendix is not meant  to be exhaustive,
but merely to convey the flavor of the intended usage of the construct.

<h3>Internal Invariants</h3>
<p><b>It is generally appropriate to liberally sprinkle code with short
assertions indicating important assumptions concerning the programs
behavior.</b> In the absence of an assertion facility, many programmers did
this with comments.  For example:
<pre>
    if (i%3 == 0) {
        ...
    } else if (i%3 == 1) {
        ...
    } else { // <b>(i%3 == 2)</b>
        ...
    }
</pre>
<b>Whenever you come across a comment that asserts an invariant,
you should change it to an assert:</b>
<pre>
    if (i % 3 == 0) {
        ...
    } else if (i%3 == 1) {
        ...
    } else {
        assert i%3 == 2;
        ...
    }
</pre>
The above example, where an assert protects the else-clause in a multiway
if-statement is quite common.  Note, incidentally, that the assertion in the
above example may fail if <tt>i</tt> is negative, as the <tt>%</tt> operator
is not a true mod operator, but computes the <i>remainder</i>, which may be
negative.

<h3>Control-Flow Invariants</h3>
<p><b>Another good candidate for an assertion is a switch statement with no
default case:</b>
<pre>
    switch(suit) {
      case Suit.CLUBS:
        ...
        break;

      case Suit.DIAMONDS:
        ...
        break;

      case Suit.HEARTS:
        ...
        break;

      case Suit.SPADES:
        ...
    }
</pre>
It is probably the case that the programmer believes that one of the four
cases in the above switch statement will always be executed.  This assumption 
may be tested by adding the following default case:
<pre>
      default:
        assert false;
</pre>
More generally, the statement
<pre>
    assert false;
</pre>
should be placed at in locations the programmer believes to be "unreached"
For example, suppose you have a method that looks like this:
<pre>
    void foo() {
        for (...) {
            if (...)
                return;
         }
         // Execution should never reach this point!!!
    }
</pre>
The final comment should be replaced by 
<pre>
    assert false;
</pre>
This technique must be used with some discretion; if a statement is
<i>unreachable</i> as defined in (JLS 14.19), you'll get a compile time error
if you try to assert that it is unreached.

<h3>Preconditions, Postconditions, and Class Invariants</h3>

<p>While the <tt>assert</tt> construct is not a full-blown design-by-contract
facility, it can help support an informal design-by-contract style of
programming.

<h4>Preconditions</h4>
<p>By existing convention in Java, preconditions on public methods are enforced
by explicit checks inside methods resulting in particular, specified
exceptions.  For example:
<pre>
    /**
     * Sets the refresh rate.
     *
     * @param  rate refresh rate, in frames per second.
     * @throws IllegalArgumentException if <tt>rate <= 0</tt> or
     *          <tt>rate > MAX_REFRESH_RATE</tt>.
     */
     public void setRefreshRate(int rate) {
         // <b>Enforce specified precondition in public method</b>
         if (rate <= 0 || rate > MAX_REFRESH_RATE)
             throw new IllegalArgumentException("Illegal rate: " + rate);

         setRefreshInterval(1000/rate);
     }
</pre>
This convention is unaffected by the addition of the <tt>assert</tt>
construct.  This construct is inappropriate for such preconditions, as the
enclosing method guarantees that it will enforce the argument checks, whether
or not assertions are enabled.  Further, the <tt>assert</tt> construct does
not throw an exception of the specified type.

<p>If, however, there is a precondition on a nonpublic method and the author of
a class believes the precondition to hold no matter what a client does with
the class, then an assertion is entirely appropriate:
<pre>
   /**
    * Sets the refresh interval (which must correspond to a legal frame rate).
    *
    * @param  interval refresh interval in milliseconds.
    */
    private void setRefreshInterval(int interval) {
        // <b>Confirm adherence to precondition in nonpublic method</b>
        assert interval > 0 && interval <= 1000/MAX_REFRESH_RATE;

        ... // Set the refresh interval
    }
</pre>
Note, by the way, that the above assertion will fail if
<tt>MAX_REFRESH_RATE</tt> is greater than <tt>1000</tt> and the user selects a
refresh rate greater than <tt>1000</tt>; this would, in fact, indicate a bug
in the library!

<h4>Postconditions</h4>

<p>Postcondition checks are best implemented via assertions, whether or not
they are specified in public methods.  For example:
<pre>
    /**
     * Returns a BigInteger whose value is <tt>(this<sup>-1</sup> mod m)</tt>.
     *
     * @param  m the modulus.
     * @return <tt>this<sup>-1</sup> mod m</tt>.
     * @throws ArithmeticException <tt> m &lt;= 0</tt>, or this BigInteger
     *	       has no multiplicative inverse mod m (that is, this BigInteger
     *	       is not <i>relatively prime</i> to m).
     */
    public BigInteger modInverse(BigInteger m) {
	if (m.signum <= 0)
	    throw new ArithmeticException("Modulus not positive: " + m);
        if (!this.gcd(m).equals(ONE))
	    throw new ArithmeticException(this + " not invertible mod " + m);

        ... // Do the computation

        assert this.multiply(result).mod(m).equals(ONE);
        return result;
    }
</pre>
In practice, one would <i>not</i> check the second precondition,
(<tt>this.gcd(m).equals(ONE)</tt>) prior to performing the computation,
because it is wasteful; this precondition is checked as as a side effect of
performing the modular multiplicative inverse computation by standard
algorithms.

<p>Occasionally, it is necessary to save some data prior to performing a
computation in order to check a postcondition after it is complete.  This can
be done with two <tt>assert</tt> statements and the help of a simple inner
class designed to save the state of one or more variables so they can be
checked (or rechecked) after the computation.  For example, suppose you have a
piece of code that looks like this:
<pre>
    void foo(int[] array) {
        // Manipulate array
        ...

        // At this point, array will contain exactly the ints that it did
        // prior to manipulation, in the same order.
    }
</pre>
Here is how you could modify the above method to turn the textual assertion
into a functional one:
<pre>
    void foo(final int[] array) {

        class DataCopy {
            private int[] arrayCopy;

            DataCopy() { arrayCopy = (int[])(array.clone()); }

            boolean isConsistent() { return Arrays.equals(array, arrayCopy); }
        }

        DataCopy copy = null;

        // <b>Always succeeds; has side effect of saving a copy of array</b>
        assert (copy = new DataCopy()) != null;

        ... // Manipulate array

        assert copy.isConsistent();
     }
</pre>
Note that this idiom easily generalizes to save more than one data field, and
to test arbitrarily complex assertions concerning pre-computation and
post-computation values.

This idiom is less than pretty, but it is expedient.  The first
<tt>assert</tt> statement (which is executed solely for its side-effect) could
be replaced by the more expressive:
<pre>
    copy = new DataCopy();
</pre>
but this would copy the array whether or not asserts were enabled,
violating the dictum that asserts should have no cost when disabled.

<h4>Class Invariants</h4>

As noted above, assertions are appropriate for checking internal
invariants.  The assertion mechanism itself does not enforce any particular
style here.  It is sometimes convenient to combine many expressions that check
required constraints into a single internal method that can then be
invoked by assertions.  For example, suppose one were to implement a balanced
tree data structure of some sort.  It might be appropriate to implement a
private method that checked that the tree was indeed balanced as per the
dictates of the data structure:
<pre>
    // Returns true if this tree is properly balanced
    private boolean balanced() {
        ...
    }
</pre>
This method is a <i>class invariant</i>.  It should be always be true before
and after any method completes.  To check that this is indeed the case, each
public method and constructor should contain the line:
<pre>
    assert balanced();
</pre>
immediately prior to each return.  It is overkill to place similar checks at
the head of each public method <i>unless the data structure is implemented by
native methods</i>.  In this case, it is possible that a memory corruption bug
could "stomp on" the data structure in between method invocations. A failure
of this assertion at the head of a call would indicate that memory
corruption had occurred.

<h3>Removing all Trace of Assertions from Class Files</h3>

<p>Programmers developing for resource-constrained devices may wish to strip
assertions out of class files entirely.  While this makes it impossible to
enable assertions in the field, it also reduces class file size, possibly
leading to improved class loading performance.  In the absence of a high
quality JIT, it could lead to decreased footprint and improved runtime
performance.

<p>The assertion facility offers no direct support for stripping assertions
out of class files.  However, the <tt>assert</tt> statement may be used in
conjunction with the "conditional compilation" idiom described in JLS 14.19:
<pre>
     static final boolean asserts = ... ; // false to eliminate asserts

     if (asserts)
         assert &lt;expr&gt; ;
</pre>
If asserts are used in this fashion, the compiler is free to eliminate all
traces of these asserts from the class files that it generates.  It is
recommended that this be done where appropriate to support generation of code
for resource-constrained devices.

<h3>Requiring that Assertions are Enabled</h3>

On a related note, programmers of certain critical systems might wish to
ensure that assertions are <i>not</i> disabled in the field.  Here is an idiom
that prevents a class from being loaded if assertions have been disabled for
that class:
<pre>
    static {
        boolean assertsEnabled = false;
        assert assertsEnabled = true; // <b>Intentional side effect!!!</b>
        if (!assertsEnabled)
            throw new RuntimeException("Asserts must be enabled!!!");
    }
</pre>



<H2>Appendix II. Enabling and Disabling Assertions in the Interpreter</A></H2>

Sun's java interpreters will disable assertions by default.  Two command-line
switches will be added to Sun's java interpreters to selectively enable or
disable assertions.  These command-line switches are <I>not</I> part of the
specification for assertions, but are illustrative of how an implementation of
the Java runtime environment might enable and disable assertions.  (We do not
specify flags as part of the Java platform.)

<p>The following switch enables assertions at various granularities: 
<PRE>
java [ -enableassertions | -ea  ] [:&lt;package name&gt;"..." | :&lt;class name&gt; ]
</PRE>

With no arguments, the switch enables assertions by default.  With one
argument ending in <TT>"..."</TT>, the switch enables assertions in the
specified package and any subpackages by default.  If the argument is simply
"...", the switch enables assertions in the unnamed package in the current
working directory.  With one argument not ending in <TT>"..."</TT>, the switch
enables assertions in the specified class.

<p>The following switch disables assertions in similar fashion: <PRE>
java [ -disableassertions | -da ] [:&lt;package name&gt;"..." | :&lt;class name&gt; ]
</PRE>
If a single command line contains multiple instances of these 
switches, they are processed in order before loading any classes. 
So, for example, to run a program with assertions enabled only in 
package <TT>com.wombat.fruitbat</TT> (and any subpackages), the following
command could be used:
<PRE>java -ea:com.wombat.fruitbat... &lt;Main Class&gt;
</PRE>To run a program with assertions enabled in package
<TT>com.wombat.fruitbat</TT> but disabled in class
<TT>com.wombat.fruitbat.Brickbat</TT>, the following command could
be used: <PRE>java -ea:com.wombat.fruitbat... -da:com.wombat.fruitbat.Brickbat &lt;Main Class&gt;
</PRE>

<p>Some care must be exercised by the interpreter in choosing the class loader
(or class loaders) on which to set assertion status when processing each
<tt>-da</tt> and <tt>-ea</tt> flag.  If the interpreter cannot positively
identify which class loader will be used to load a named class or package, it
is prudent to set the assertion status on multiple class loaders to ensure
that the assertion status is set on the correct class loader.

<p>Finally, it is recommended that a system-specific mechanism, such as a
well-known <TT>Properties</TT> file, be used to persistently specify a set
of packages or classes that should have assertions turned on (or
off). Installation scripts could set such properties appropriately.  For
example, installing a production release might turn off assertions in all of
its packages for enhanced performance, while installing a Beta release might
turn on assertions to provide more thorough testing. (There are dangers
associated with this approach: turning off asserts could expose
timing-dependent bugs.)  It is recommended that command line switches take
precedence over persistent specifications at the same granularity.  Sun's java
interpreters will support such a mechanism, the details to be determined
later.

<a name=phasedIntro><H2>Appendix III. Source Compatibility</H2></a>

The addition of the <tt>assert</tt> keyword to the Java Programming Language
causes existing programs that use <tt>assert</tt> as an identifier to become
invalid.  The addition of this keyword does not, however, cause any problems
with the use of preexisting binaries (.class files).

In order to ease the transition from a world where <tt>assert</tt> is a legal
identifier to one where it isn't, it is suggested that compilers support two
modes of operation in the initial J2SE release supporting assertions.  (For
the sake of the explanation, let us assume that this is release 1.4.)
<ul>
<li>In the normal mode of operation the compiler accepts programs
conforming to the specification for release 1.4; assertions are permitted, and
the compiler generates an error message if the assert keyword is used as an
identifier or label.

<li>In an alternate mode of operation, the compiler accepts
programs conforming to the specification for release 1.3; assertions are
not permitted, and the compiler generates a warning if the assert keyword
is used as an identifier or label.
</ul>

The developer selects the appropriate the mode of operation in some
manner appropriate to the compiler.  Sun's <tt>javac</tt> will likely have a
command line switch that serves this function, perhaps:
<pre>
    -source &lt;release&gt;
</pre>
where <tt>&lt;release&gt;</tt> can be <tt>"1.3"</tt> or <tt>"1.4"</tt>.
Support for 1.3 source compatibility would likely be phased out over
time.

<H2>Appendix IV. Implementation Notes</H2>

It is highly desirable that the execution of disabled assertions have little
or no cost at runtime.  Further, it is required by this specification that the
assertion facility does not require any changes to the class file format or
the JVM specification.  An implementation that meets these criteria is
sketched below.  Note that this section describes only one way in which this
specification can be implemented; it places no constraints on JVM
implementors, who are free to implement the specification in any manner they
see fit.

<p>Class <TT>ClassLoader</TT> gets three new private fields, which 
it uses to keep track of the <I>desired assertion status</I> of 
classes not yet loaded:
<PRE>
    private boolean defaultAssertionStatus = false;

    // Maps String packageName to Boolean package default assertion status
    private Map packageAssertionStatus = new HashMap();

    // Maps String fullyQualifiedClassName to Boolean assertionStatus
    private Map classAssertionStatus   = new HashMap();
</PRE>
These fields are maintained by the three new public 
<TT>ClassLoader</TT> methods in the obvious fashion. In fact, the 
<I>only</I> thing that these methods do is to modify these fields 
(or the maps they reference). 

<p>The compiler adds a synthetic field to every top-level class
containing the <I>actual assertion status</I> of the class (and any nested
classes).
<PRE>    private static final boolean $assertionsEnabled =
      &lt;ClassName&gt;.class.getClassLoader().desiredAssertionStatus("&lt;ClassName&gt;");
</PRE>The name of this field need not be part of the specification: 
it is local to the class and can vary from implementation to
implementation and class to class.  As an optimization, compilers
needn't generate this field for classes that contain no
<i>reachable</i> (JLS 14.19) <tt>assert</tt> statements.

<p>The <TT>assert</TT> statement, then, is merely syntactic sugar 
for this:
<PRE>
do {
    if ($assertionsEnabled &amp;&amp; !(<I>Expression<sub>1</sub></I>))
        throw new AssertionError(String.valueOf(<I>Expression<sub>2</sub></I>));
} while(false);
</PRE>The surrounding do-while loop is merely an artifice to
transform the <tt>if</tt> statement to the correct syntactic category
(<I>StatementWithoutTrailingSubstatement</I>), and has no semantics associated
with it.  Note that this implementation works equally well in static and
instance  methods (and constructors, static initializers, and instance
initializers, for that matter).

<p>The runtime does not need to treat this code specially in order to "strip
out" assertions from classes when they're disabled!  Because
<TT>$assertionsEnabled</TT> is final, the JIT can easily determine that the
entire <TT>if</TT> statement has no effect, and eliminate it in the compiled
code that it generates. Present day JITs (including HotSpot) do this
optimization.

<p>Note also that <TT>$assertionsEnabled</TT> resolves to the 
so-named field in the "declaring class" for the containing method. 
The resulting behavior is clearly desirable, though it may be 
somewhat surprising. If one class extends another, and assertions 
are enabled only in the subclass, assertions contained in (any) 
inherited superclass methods will not be executed. 

<p>This sketch glosses over the details of computing the correct
<TT>AssertionError</TT> object to throw (as specified in the <A 
href="#semantics">Semantics</A> section of this proposal). It should be clear,
however, that this  presents no real difficulties.

<p>Note that this implementation does not support control over assertions in
"low-level" system classes (<TT>ClassLoader</TT> and any classes 
that are loaded before <TT>ClassLoader</TT>).  At present, there are no
assertions in these low-level systems classes, so this is not viewed as
a significant issue.

<H2>Appendix V. Design FAQ</h2>

This collection of frequently asked questions concerning the design of the 
assertion facility is meant to serve as a design rationale.

<h3>General Questions</h3>

<ol>
<b><li>Why provide an assertion facility at all, given that one can program
assertions atop the Java programming language with no special support?</b>

<p>Although ad hoc implementations are possible, they are of necessity either
ugly (requiring an <tt>if</tt> statement for each assertion) or inefficient
(evaluating the condition even if assertions are disabled).  Further, each ad
hoc implementation has its own means of enabling and disabling assertions,
which lessens the utility of these implementations, especially for debugging
in the field.  As a result of these shortcomings, assertions have never become
a part of the Java culture.  Adding assertion support to the platform stands a
good chance of rectifying this situation.

<p><b><li>Why does this facility justify a language change, as opposed to a
library solution?</b>

<p>We recognize that a language change is a serious effort, not to be
undertaken lightly.  The library approach was considered very seriously.  It
was, however, deemed essential that the runtime cost of assertions be
negligible if they are disabled.  In order to achieve this with a library, the
programmer is forced to hard-code each assertion as an <tt>if</tt> statement.
Many programmers would not do this.  Either they'd omit the if statement and
performance would suffer, or they'd ignore the facility entirely.  Note also
that assertions were contained in James Gosling's original specification for
Java, nee Oak. Assertions were removed from the Oak specification because time
constraints prevented a satisfactory design and implementation.

<p><b><li>Why not provide a full-fledged <i>design-by-contract</i> facility
with <i>preconditions</i>, <i>postconditions</i> and <i>class invariants</i>,
like the one in the Eiffel programming language?</b>

<p>We seriously considered providing such a facility, but were unable to
convince ourselves that it is possible to graft it onto the Java programming
language without massive changes to the Java platform libraries, and massive
inconsistencies between old and new libraries.  Further, we were not convinced
that such a facility would preserve the simplicity that is Java's hallmark.
On balance, we came to the conclusion that a simple boolean assertion facility
was a clear knee-in-the-curve, and far less risky.  It's worth noting that
adding a boolean assertion facility to the language doesn't preclude adding a
full-fledged design-by-contract facility at some time in the future.

<p>The simple assertion facility does enable a limited form of
design-by-contract style programming.  The <tt>assert</tt> statement is
appropriate for postcondition and class invariant checking.  Precondition
checking should still be performed by checks inside methods that result in
particular, documented exceptions, such as <tt>IllegalArgumentException</tt>
and <tt>IllegalStateException</tt>.

<p><b><li>In addition to boolean assertions, why not provide an
<tt>assert</tt>-like construct to suppress the execution of an entire block of
code if assertions are disabled?</b>

<p>Providing such a construct would encourage programmers to put
complex assertions inline, when they are better relegated to
separate methods.
</ol>

<h3>Compatibility</h3>

<ol>
<p><b><li>Won't the new keyword cause compatibility problems with existing
programs that use <tt>assert</tt> as an identifier?</b>

<p>Yes, for source files.  (Binaries for classes that use <tt>assert</tt> as
an identifier will continue to work fine.)  To ease the transition, we
describe <a href="#phasedIntro">a strategy</a> whereby developers
can continue using <tt>assert</tt> as an identifier during a transitional
period.

<p><b><li>Doesn't the implementation sketch in Appendix IV produce class files
that cannot be run against older JREs?</b>

<p>Yes.  Class files will contain calls to the new <tt>ClassLoader</tt>
methods, such as, <tt>desiredAssertionStatus</tt>.  If a class file containing
calls to these methods is run against an older JRE (whose <tt>ClassLoader</tt>
class doesn't define the methods), the program will fail at run time, throwing
a <tt>NoSuchMethodError</tt>.  While it would be possible to circumvent this
problem by catching the <tt>NoSuchMethodError</tt>, Java platform implementors
are under no obligation to do this.

</ol>
<h3>Detailed Syntax and Semantics</h3>

<ol>
<b><li>Why allow primitive types in <i>Expression<sub>2</sub></i>?</b>

<p>There is no compelling reason to restrict the type of this expression.
Allowing arbitrary types provides convenience, e.g., for developers who want
to associate a unique integer code with each assertion.  Further, it makes
this expression feel like System.out.print(...), which is desirable.
</ol>

<h3>The AssertionError Class</h3>

<ol>

<b><li>When an <tt>AssertionError</tt> is generated by an <tt>assert</tt>
statement in which <i>Expression<sub>2</sub></i> is absent,
why isn't the program text of the asserted condition used as the detail
message (e.g., <tt>"height &lt; maxHeight"</tt>)?</b>

<p>While doing so might improve out-of-the-box usefulness of assertions in
some cases, the benefit doesn't justify the cost of adding all these string
constants to .class files and runtime images.

<p><b><li>Why doesn't an <tt>AssertionError</tt> allow access to the object
that generated it? Similarly, why not pass an arbitrary object from the
assertion to the <tt>AssertionError</tt> in place of a "detail message"?</b>

<p>Access to these objects would encourage programmers to attempt to recover
from assertion failures, which defeats the purpose of the facility.

<p><b><li>Why not provide "context accessors" (<tt>getFile</tt>,
<tt>getLine</tt>, <tt>getMethod</tt>) on <tt>AssertionError</tt>?</b>

<p>This facility is best provided on <tt>Throwable</tt>, so it may be
used for all throwables, and not just just assertion errors.  We intend to
enhance <tt>Throwable</tt> to provide this functionality in the same
release in which the assertion facility first appears.
</ol>

<h3>Enabling and Disabling Assertions</h3>

<ol>
<b><li>Why not provide a compiler flag to completely eliminate assertions from
object files?</b>

<p>It is a firm requirement that it be possible to enable assertions in the
field, for enhanced serviceability.  It would have been possible to also
permit developers to eliminate assertions from object files at compile time.
However, since assertions can contain side effects (though they should not),
such a flag could alter the behavior of a program in significant ways.  It is
viewed as good thing that there is only one semantics associated with each
valid Java program.  Also, we want to encourage users to leave asserts in
object files so they can be enabled in the field.  Finally, the standard Java
"conditional compilation idiom" described in JLS 14.19 can be used to achieve
this effect for developers who really want it.

<p><b><li>Why does <tt>setPackageAssertionStatus</tt> have "package tree"
semantics instead of the more obvious package semantics?</b>

<p>Hierarchical control is useful, as programmers really do use
package hierarchies to organize their code.  For example, package-tree
semantics allow assertions to be enabled or disabled in all of
Swing in one fell swoop.

<p><b><li>Why does <tt>setClassAssertionStatus</tt> return a boolean instead of
throwing an exception if it is invoked when it's too late to set the assertion
status (i.e., the named class has already been loaded)?</b>

<p>No action (other than perhaps a warning message) is necessary or desirable
if it's too late to set the assertion status.  An exception seems unduly
heavyweight.

<p><b><li>Why not overload a single method to take the place of
<tt>setDefaultAssertionStatus</tt> and <tt>setAssertionStatus</tt>?</b>

Clarity in method naming is for the greater good.

<p><b><li>Why not tweak the semantics of <tt>desiredAssertionStatus</tt> to make
it more "programmer friendly," e.g., by returning the actual assertion status
if a class is already loaded?</b>

<p>It's not clear that there would be any use for the resulting method
The method isn't designed for application programmer use, and it seems
inadvisable to make it slower and more complex than necessary.

<p><b><li>Why is there no RuntimePermission to prevent applets from
enabling/disabling assertions?</b>

<p>While applets have no reason to call any of the <tt>ClassLoader</tt>
methods for modifying assertion status, allowing them to do so seems harmless.
At worst, an applet can mount a weak denial-of-service attack by turning on
asserts in classes that have yet to be loaded by its <tt>URLClassLoader</tt>.

<p><b><li>Why not provide a construct to query the assert status of the
containing class?</b>

<p>Such a construct would encourage people to inline complex assertion code,
which we view as a bad thing:
<pre>
    if (assertsEnabled()) {
        ...
    }
</pre>
Further, it is straightforward to query the assert status atop the
current API, if you feel you must:
<pre>
   boolean assertsEnabled = false;
   assert assertsEnabled = true;  // <b>Intentional side-effect!!!</b>
   // Now assertsEnabled is set to the correct value
</pre>
</ol>

<font size=-2>
Copyright 2000 Sun Microsystems, Inc., 901 San Antonio Road, Palo Alto, California 94303 U.S.A. All rights reserved.
</font>
</BODY></HTML>



<!-- ** BEGIN: footer.jsp ** //-->








</td>
</tr>
</table>

<!-- ** END: Content Table ** //-->

<!-- ** BEGIN: Footer Table ** //-->

<div id="footer" style="clear: both;">
    <div class="footleft">
        <a href="/en/resources/contacts">Contact Us</a>
    </div>
	
    <div class="botbar"><img src="/images/spacer.gif" alt="" height="23" width="1"></div>

    <div class="footleft2">
         &copy; 2019, Oracle Corporation and/or its affiliates. 
        <a href="/en/home/terms">Terms of Use</a>. <a href="http://www.oracle.com/us/legal/privacy/index.html">Privacy Policy</a>. <a href="http://www.oracle.com/us/legal/third-party-trademarks/third-party-trademarks-078568.html">Trademarks</a>
    </div>

    <div class="footright">
        <img src="/images/common/logo_oracle_footer.gif" alt="Oracle Corporation" height="22" width="91">
    </div>

    <div style="clear: both;"><img src="/images/spacer.gif" alt="" height="30" width="1"></div>
</div>

<!-- ** END: Footer Table ** //-->



<!-- ** Menu Start ** //-->



</body>
</html>
<!-- ** END: footer.jsp ** //-->

